{% extends "base.html" %}

{% block content %}
<h1>Email Sentiment & Priority Analyzer</h1>
<h2>Welcome, {{ current_user.username }}!</h2>

<h3>Analyze Emails</h3>
<form method="POST" enctype="multipart/form-data">
    <label for="email_select">Select Predefined Emails:</label><br>
    <select name="email_select" id="email_select" multiple>
        <option value="">-- Select Emails --</option>
        {% for email in emails %}
            <option value="{{ email.id }}">{{ email.subject }}</option>
        {% endfor %}
    </select><br><br>
    <label>Or Upload a .txt File:</label><br>
    <input type="file" name="email_file" accept=".txt"><br><br>
    <button type="submit" style="background-color: green; color: white; padding: 10px 20px;">Analyze</button>
</form>

<h3>Analysis Results</h3>
<table border="1">
    <tr>
        <th>Subject</th>
        <th>Sentiment</th>
        <th>Priority</th>
        <th>Tone</th>
        <th>Categories</th>
        <th>Spam/Phishing</th>
        <th>Summary</th>
        <th>Reply Suggestion</th>
    </tr>
    {% for result in analysis_results %}
        <tr>
            <td>{{ result.subject }}</td>
            <td>{{ result.sentiment }}</td>
            <td>{{ result.priority }}</td>
            <td>{{ result.tone }}</td>
            <td>{{ result.categories | join(', ') }}</td>
            <td>{{ result.spam_phishing }}</td>
            <td>{{ result.summary }}</td>
            <td>{{ result.reply_suggestion }}</td>
        </tr>
    {% endfor %}
</table>

<h3>Export Results</h3>
<form method="POST" action="{{ url_for('export') }}">
    <button type="submit" name="export_type" value="csv" style="background-color: green; color: white; padding: 10px 20px;">Export as CSV</button>
    <button type="submit" name="export_type" value="pdf" style="background-color: green; color: white; padding: 10px 20px;">Export as PDF</button>
    <button type="submit" name="export_type" value="txt" style="background-color: green; color: white; padding: 10px 20px;">Export as Text</button>
</form>

<h3>Search & Sort</h3>
<form method="GET">
    <label for="search">Search Emails:</label><br>
    <input type="text" name="search" id="search" placeholder="Enter keywords"><br><br>
    <label for="sort">Sort By:</label><br>
    <select name="sort" id="sort">
        <option value="priority">Priority</option>
        <option value="sentiment">Sentiment</option>
        <option value="tone">Tone</option>
    </select><br><br>
    <button type="submit" style="background-color: green; color: white; padding: 10px 20px;">Search & Sort</button>
</form>

<h3>Analytics</h3>
<p><strong>Total Emails Analyzed:</strong> {{ analytics.total_emails }}</p>
<p><strong>Sentiment Breakdown:</strong> Positive: {{ analytics.positive }}, Negative: {{ analytics.negative }}, Neutral: {{ analytics.neutral }}</p>
<p><strong>Priority Breakdown:</strong> High: {{ analytics.high_priority }}, Medium: {{ analytics.medium_priority }}, Low: {{ analytics.low_priority }}</p>

<h3>Analysis History</h3>
<ul>
    {% for analysis in analyses %}
        <li>{{ analysis.subject }} - Priority: {{ analysis.priority }} - Timestamp: {{ analysis.timestamp }}</li>
    {% endfor %}
</ul>

<form action="{{ url_for('logout') }}">
    <button type="submit" style="background-color: red; color: white; padding: 10px 20px;">Logout</button>
</form>
{% endblock %}